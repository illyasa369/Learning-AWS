# Load Balancing and Scalability

## Scalability
Scalability - The ability of a system to handle greater loads by scaling.

Two kinds of scaling:
- Vertical Scaling: Increasing the size of the instance.
- Horizontal Scaling: Increasing the number of instances.
<br>

## High Availability
High Availability (HA): The process of keeping systems running even if something fails.

In AWS, HA is achieved by utilizing multiple AZs. If one AZ fails, another takes over.

Two types of HA:
- Passive: One main system and a standby system.
- Active: Multiple systems running at the same time.
<br>

## Load Balancers
Load balancers are servers that distribute incoming traffic across multiple downstream servers.

Benefits of using a Load Balancer:
- Spreads traffic across many servers so no server is overwhelmed by traffic.
- Gives one DNS endpoint for users.
- Regular health checks for instances.
- Handles instance failures - Stops sending traffic to unhealthy instances.
- Keeps users on the same servers (sticky sessions).
- Improves availability across AZs.
- Handles HTTPS security.

Benefits of using AWS ELBs:
- Managed service: AWS handles upgrades, maintenance and HA.
- Integration with many AWS services (EC2, ASG, Route 53, CloudWatch).
<br>

### Health Checks
Indicates to a load balancer whether a server is operational or not.

- The LB sends a request to a port + path (/health).
- Expects a 200 OK response.
- If a server is unhealthy, the LB stops sending traffic to it.
<br>

### Types of Load Balancers on AWS
- Classic Load Balancers, CLB
- Application Load Balancers, ALB: Best for HTTP/HTTPS traffic.
- Network Load Balancers, NLB: Best for low-latency, high-performance TCP/UDP traffic.
- Gateway Load Balancers, GLB: Used to route and scale traffic through virtual appliances.
<br>

### Load Balancer Security Groups
- Classic and Application Load Balancers use security groups.

- Load Balancers and EC2 instances use separate SGs.

- The Load Balancer's SG allows inbound HTTP and HTTPS traffic from 0.0.0.0/0 (public internet).

- The EC2 instance’s security group allows HTTP traffic only from the Load Balancer’s security group, so users cannot access the instance directly.
<br>

### Application Load Balancers
- Operates at layer 7.
- Handles HTTP and HTTPS requests.
- Can inspect request content; URL paths, hostnames, headers, query strings and so on.
- Routes traffic to multiple target groups. Targets can be EC2 instances, Containers (ECS) or Lambda functions.
<br>

Good to know:
- Client connections end at the ALB, EC2 sees the ALB's private and not client info (IP address, Port, Protocol).
- Client information included in HTTP headers.
- Application must read these headers to get the true client info (for logging, analytics, geolocation, security, etc).
<br>

### Network Load Balancers
- Operates at layer 4.
- Forwards traffic without inspecting HTTP headers or terminating SSL.
- Routes traffic based on ports or protocols to target groups, not content like ALBs.
<br>

### Sticky Sessions
- Sticky sessions ensure that a client is always connected to the same server during a session.
- Works with CLB, ALB and NLB.
- For CLB and ALB, stickiness has an expiration date that can be set.
- Use case: Making sure a user doesn't lose their session data.
- Drawback: Can cause uneven load if certain servers are receiving more traffic than others.
<br>

### SSL/TLS
- SSL: Secure Sockets Layer.
- TLS: Transport Layer Security (Newer version of SSL).
<br>

- An SSL/TLS certificate encrypts data while it is being sent between a client and a server.
- Public SSL certificates are issued by the Certificate Authority.
- Certificates have an expiration date and must be renewed.
<br>

#### Load Balancers - SSL Certificates
- Load Balancers use X.509 certificates (SSL/TLS certificates).
- Certificates managed using AWS Certificate Manager, ACM.
- Alternatively, certificates can be uploaded.
<br>

- Load Balancers use an HTTPS listener on port 443 to accept HTTPS connections.
- A default certificate is required.
- For multiple domains, extra certificates can be added.
- When a client connects, it uses Server Name Indication which tells the LB which hostname it wants.
- The LB selects the matching certificate or the default one if no match exists.

